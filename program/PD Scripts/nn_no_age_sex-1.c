//Analysis Type - Regression 
#include <stdio.h>
#include <conio.h>
#include <math.h>
#include <stdlib.h>


double input_hidden_weights[28][5]=
{
 {9.13095842126185e-001, 9.81116916548198e-001, 5.07128708248913e-001, 9.63697787153795e-001, 1.83929403384575e-001 },
 {7.51551145470510e-001, 1.41931641974583e+000, 1.30119316062904e+000, 1.47934387758458e+000, -9.55296014685070e-001 },
 {1.95179422885797e+000, 3.01117103158221e+000, -2.95933144672409e+000, 2.74682476429336e+000, -2.02946220597937e+000 },
 {5.48666781994185e-001, 1.30244019220369e+000, 2.23614012826857e-001, 1.21371718924167e+000, -9.77157234950394e-001 },
 {1.06524526456761e+000, 2.26329763847491e+000, 1.79227585941340e+000, 2.13176316625282e+000, -6.46238746404529e-001 },
 {1.30633355215450e+000, 1.46591835082310e+000, 1.03323374574016e+000, 1.49036374196140e+000, -2.68049672966551e+000 },
 {-1.24880787910319e+000, 1.57484107749865e+000, 2.10125003838582e+001, 2.78426216950564e+000, 1.90567298263371e+000 },
 {1.27380459101098e+000, 2.87664597444225e+000, 2.70268967605224e+000, 3.20036679465667e+000, -3.01392819150734e+000 },
 {5.24374435109312e-001, 1.16948677395282e+000, 1.04629254858083e+000, 1.14708766414338e+000, -1.19383140514436e+000 },
 {4.20061249525034e-001, 1.01778693636245e+000, 8.74787626971805e-001, 9.89961997254815e-001, -8.94783995922346e-001 },
 {1.49660777209167e+000, 1.76211702491822e+000, 1.12228439764896e+000, 1.81471559405979e+000, -2.87393126414224e+000 },
 {3.25378821516197e+000, 5.59505388665849e+000, 4.98346677706174e+000, 5.95603561477200e+000, -2.09274651172797e+000 },
 {8.78378760104571e-001, 3.28666174923187e+000, 2.08703253127986e+000, 3.01502634230258e+000, -6.47288651231732e-001 },
 {8.19111503605824e-001, 1.00383393095394e+000, 8.93976921720831e-001, 1.07085436005284e+000, -1.53540767675008e+000 },
 {2.21633074507430e+000, 1.58905913757839e+000, 1.29689600503248e+000, 1.67398496037931e+000, 7.23998052068175e-001 },
 {-1.64962521874769e-001, 1.42460498508263e-001, -5.16118965837517e-001, 1.43305114743413e-001, 1.23914899688605e-001 },
 {7.20194684168672e-001, 1.28209713047051e+000, 1.02489544879476e+000, 1.39563559010500e+000, -2.60566468901376e+000 },
 {8.88068585992025e-002, 6.45812812805474e-001, 4.82319543470891e-001, 6.43115396830543e-001, -5.90625058365381e-001 },
 {2.36003066809108e+000, 5.25813786607149e+000, 1.52558365066090e+000, 4.47833661983266e+000, -9.23112213891177e-001 },
 {3.15718997888981e-001, 3.60020730545905e+000, -7.78199030269778e-001, 3.21917021418313e+000, -2.91695874889523e+000 },
 {3.39050772398199e+000, 4.79668497755662e+000, 2.46581634197783e+000, 5.46022516318966e+000, -2.12476232179397e+000 },
 {-6.71942482372494e-001, 1.03939498458117e+001, -5.09056218444702e+000, 1.06764310164081e+001, -3.04991466349350e-001 },
 {1.07856781607043e+000, 1.33362866242548e+000, 1.14123489765961e+000, 1.35748502547866e+000, -1.56656267235985e+000 },
 {2.01637614020626e+000, 2.14435843028123e+000, 1.91105846720550e+000, 2.17137602256164e+000, -2.55117034076118e+000 },
 {2.92169761948083e+000, 6.55611884457850e+000, 9.89353940948302e+000, 4.81838502308437e+000, -1.33986426961379e+000 },
 {6.89111081473707e-001, 1.27666691423673e+000, 1.22604604468047e+000, 1.28266081223982e+000, -8.97956800115382e-001 },
 {4.51652375636428e-001, 1.06380883197064e+000, 9.36897643201876e-001, 1.01690301300746e+000, -9.69096731705386e-001 },
 {1.48406856756190e+000, 2.79652347319544e+000, 1.31296533123638e+000, 2.92945236770070e+000, -4.14305495227512e+000 } 
};

double hidden_bias[28]={ 1.48534907468324e-001, 5.08434483428255e-001, 3.26643269429374e-002, -1.68999539692049e+000, 9.83568751110934e-001, 1.93007598022494e-001, -4.03988858528639e-001, 2.50175732504307e+000, -4.08054628846783e-001, -2.96091946436900e-001, 5.51610543372958e-001, 2.47206651109193e+000, 1.27356360720324e+000, -5.13293762823061e-002, 1.30864605306553e+000, -1.57700425118718e+000, -6.23998707686658e-001, -1.01412251077121e+000, 2.22203511956091e+000, 1.03465488295951e+000, 1.93769087594577e+000, 1.93199246687184e-001, 5.60630126195407e-002, 9.32698657326454e-001, 1.21593034923282e+000, 5.28959031736234e-001, 2.82990230063629e-001, -4.22050542175995e-001 };

double hidden_output_wts[1][28]=
{
 {-5.32377829261336e-001, 1.42198871612881e+000, 5.59310535403148e+000, 3.18867636339697e+000, 2.00325122170171e+000, -2.02241509458174e+000, -2.37014034970209e+000, -4.99274259927434e+000, -4.91489185377645e-001, 2.60816000589080e-002, -1.93351422330681e+000, -4.62675802180542e+000, 2.89112349263369e+000, -1.05463532903518e+000, -9.03746760183935e-001, 4.07328020170650e-001, -2.16952583642872e+000, 7.10785474016784e-002, 5.03811691633144e+000, 7.75170056172501e+000, -7.48860499682980e+000, -4.23054426276910e+000, -9.17042263579334e-001, -1.30091475802096e+000, 1.00950184316987e+001, 5.38232117442683e-001, 4.00566986993622e-001, -2.54551065095480e+000 }
};

double output_bias[1]={ -2.42759289070099e+000 };

double max_input[5]={ 6.43300000000000e-002, 5.64700000000000e-002, 7.94000000000000e-002, 1.69420000000000e-001, 3.30470000000000e+001 };

double min_input[5]={ 2.04000000000000e-003, 4.68000000000000e-003, 5.70000000000000e-003, 1.40300000000000e-002, 8.44100000000000e+000 };

double max_target[1]={ 1.00000000000000e+000 };

double min_target[1]={ 0.00000000000000e+000 };

double input[5];
double hidden[28];
double output[1];

void ScaleInputs(double* input, double minimum, double maximum, int size)
{
 double delta;
 long i;
 for(i=0; i<size; i++)
 {
	delta = (maximum-minimum)/(max_input[i]-min_input[i]);
	input[i] = minimum - delta*min_input[i]+ delta*input[i];
 }
}

void UnscaleTargets(double* output, double minimum, double maximum, int size)
{
  double delta;
  long i;
  for(i=0; i<size; i++)
  {
    delta = (maximum-minimum)/(max_target[i]-min_target[i]);
    output[i] = (output[i] - minimum + delta*min_target[i])/delta;
   }
}

double logistic(double x)
{
  if(x > 100.0) x = 1.0;
  else if (x < -100.0) x = 0.0;
  else x = 1.0/(1.0+exp(-x));
  return x;
}

void ComputeFeedForwardSignals(double* MAT_INOUT,double* V_IN,double* V_OUT, double* V_BIAS,int size1,int size2,int layer)
{
  int row,col;
  for(row=0;row < size2; row++) 
    {
      V_OUT[row]=0.0;
      for(col=0;col<size1;col++)V_OUT[row]+=(*(MAT_INOUT+(row*size1)+col)*V_IN[col]);
      V_OUT[row]+=V_BIAS[row];
      if(layer==0) V_OUT[row] = exp(V_OUT[row]);
      if(layer==1) V_OUT[row] = logistic(V_OUT[row]);
   }
}

void RunNeuralNet_Regression () 
{
  ComputeFeedForwardSignals((double*)input_hidden_weights,input,hidden,hidden_bias,5, 28,0);
  ComputeFeedForwardSignals((double*)hidden_output_wts,hidden,output,output_bias,28, 1,1);
}

int main(int argc, char *argv[])
{
    if(argc == 6){
        input[0] = atof(argv[1]);
    	input[1] = atof(argv[2]);
    	input[2] = atof(argv[3]);
    	input[3] = atof(argv[4]);
    	input[4] = atof(argv[5]);
        ScaleInputs(input,0,1,5);
    	RunNeuralNet_Regression();
    	UnscaleTargets(output,0,1,1);
    	printf("PredictedState=%lf",output[0]);
        return 0;
     }else{
         printf("Not given enough arguments");
         return -1;
    }
}

