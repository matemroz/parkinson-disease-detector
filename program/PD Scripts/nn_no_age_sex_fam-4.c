//Analysis Type - Regression 
#include <stdio.h>
#include <conio.h>
#include <math.h>
#include <stdlib.h>


double input_hidden_weights[33][6]=
{
 {3.89257305067280e-002, 1.81847615547275e-001, 1.96162936807277e-001, 2.27606274938708e-001, 1.08481538891851e-001, -1.27282925866344e-001 },
 {-4.77565182351854e-002, 4.49557458055407e-001, 3.67341115626033e-001, 4.72043689143583e-001, 2.73496686701978e-001, -6.32181684223143e-001 },
 {-7.17667711058357e-001, 2.63455873342521e+000, 1.55650771678192e+000, 2.61878034706501e+000, -1.89356230512247e+000, -1.80853990398580e+000 },
 {1.56597891250082e+000, 3.27305128715283e+000, 3.62077601042973e+000, 3.19199620628646e+000, 3.48146682038556e-001, -2.39676938953165e+000 },
 {1.21572781454847e+000, 3.87882943363421e-001, -1.04345783401584e+000, 4.59396340022920e-001, -6.92365055453928e-001, 1.54960823313006e+000 },
 {-2.15329275869146e+000, 5.59650575152008e+000, 3.17355965269071e-001, 5.55063348703105e+000, -4.06118055647328e+000, -5.95824864295618e+000 },
 {-1.14407436456967e-001, 2.94696102482978e-001, 7.93246791308325e-001, 2.84941559072981e-001, 8.99976852327539e-001, -1.62688126259660e-001 },
 {-9.91006738357990e-002, 6.07981525976819e-001, 1.81741363299721e+000, 4.98185136591425e-001, 2.10994713785669e+000, -2.92280707607263e-004 },
 {1.74581203475548e+000, 1.79144840855687e-001, -4.97761019105061e-001, 2.19293172223438e-001, -2.09729364419356e+000, 2.50895427613383e+000 },
 {-7.97556530695578e-002, -9.16430916782910e+000, -1.14115331826170e+000, -9.31344985563087e+000, 3.39020971976374e+000, 1.07751076076237e+001 },
 {2.36175334324655e+000, 2.21227806866082e+000, -3.14061207019536e-001, 2.20449433220635e+000, -3.45260623773833e-001, 1.17509708641544e+000 },
 {-8.54310688226230e+000, 1.23868472617580e+000, 1.05769551147510e+001, 1.32161832188170e+000, 1.50794654171465e+000, 2.33677205539615e+000 },
 {-5.30243017180293e-002, 8.67023939832373e-001, 5.44816054454618e-001, 8.56243043807213e-001, -4.13648029824858e-001, -8.99251040583319e-001 },
 {4.46667528354985e-001, 3.73755864406664e-001, -9.88115423233499e-001, 3.88415348500670e-001, 1.86326267639473e-001, -7.43831169820129e-001 },
 {-9.71008236262565e-001, 4.58469045336533e+000, -1.50164154257983e-001, 4.63284697774138e+000, 7.80808524703473e+000, -2.91037903627692e+000 },
 {8.31923422076244e-001, 8.96411781112372e-001, 2.53418397214589e+000, 8.54178897049173e-001, 3.35471083904458e-001, 8.68639991791410e-001 },
 {-3.17832651490357e-001, 2.38287503191295e+000, 1.72880593834345e+000, 2.34795812357481e+000, -1.03184144532086e+000, -1.82633048958569e+000 },
 {2.40103782767724e+000, 2.22459467847419e+000, 5.19651850012942e+000, 2.09067273093439e+000, 4.19206232774705e+000, 2.10832773702554e-001 },
 {3.12348457404769e-001, 5.47860847970373e-001, 2.11907913710305e+000, 4.82079689794975e-001, 1.72631082734020e+000, 5.48758113065537e-001 },
 {-2.88015128692077e-001, 1.74065535358156e+000, 1.09899619700245e+000, 1.73050939764591e+000, -1.28487420883167e+000, -1.33836391866740e+000 },
 {1.59186942100208e-001, 8.24260643068006e-002, -5.74525983905709e-003, 1.73403638699000e-002, -2.13812414205106e-001, 1.38992856130738e-002 },
 {5.75657379924145e-001, 4.23338554412186e-001, -7.50260884326287e-001, 4.16693567497714e-001, -4.09088187755989e-001, -6.88139371979652e-002 },
 {1.77860717240564e-003, 1.72320748337956e-001, 1.75803823040673e-001, 2.69381791522137e-001, 1.47108401604628e-001, -3.07302398934214e-001 },
 {6.55612307519899e-001, 2.10138460672613e-001, -6.25988133914188e-001, 2.62249629688284e-001, -8.64518682181972e-001, 3.71307480389878e-001 },
 {1.19682135598121e+000, -1.20741659788573e-001, -1.39311849708627e-001, -6.60434268903750e-002, -6.96564123789641e-001, 1.23961720237139e+000 },
 {2.63057568505101e-001, 2.36479513342236e-001, 1.51372008972531e+000, 2.14538836215333e-001, 1.21893064513687e+000, 9.37441080285047e-001 },
 {1.09709498194671e+000, 1.93186014445425e+000, -6.09409008852200e-001, 2.08265297284120e+000, 1.45087068975779e+000, 6.39179254624839e-001 },
 {2.26526454017135e-001, 1.55497818771244e+000, 9.54208183765536e-001, 1.53540201036105e+000, -9.33496524850743e-001, -9.84904006738016e-001 },
 {2.53052761151284e+000, -8.05494613331016e-002, -7.68844690967062e-002, -2.32757207526839e-002, -2.40176950803228e+000, 3.67685613842037e+000 },
 {2.03089102581585e+000, 3.94372559610656e-001, -5.23375430116414e-002, 3.55766626995597e-001, -2.34085775527919e+000, 3.20733321243463e+000 },
 {2.13004341455983e+000, -6.84719707994820e-001, -3.59016994638905e-001, -6.87237355066955e-001, -1.78524653372780e+000, 3.06591706008802e+000 },
 {-4.74711242768228e-002, 4.89262363830964e-001, 2.43828592842897e-001, 4.89381905026352e-001, -3.35083332213278e-001, -1.83792342126925e-001 },
 {-3.37071561170159e-002, 2.85489424606520e-001, 2.62888193963740e-001, 2.67187514103627e-001, 2.35336418970443e-001, -3.47925083313129e-001 } 
};

double hidden_bias[33]={ 2.99008520812700e-001, 7.34132394715995e-002, -3.56092709120689e-001, -2.10138943413594e+000, -1.18936596776767e+000, 1.29525581381087e+000, 2.85207808640533e-001, 1.93239530900556e-001, 3.33888274942937e-002, -1.07095649030615e+000, -4.81549506768612e-001, -1.15064025005923e-001, -4.38025472283843e-001, 7.68233704178174e-001, -3.49136314744768e+000, -3.87852416622004e-001, -1.12192406723870e-001, -2.13005907841700e+000, 6.70094699621434e-002, -6.77274069145916e-001, -4.33377263218080e-001, 3.58937232459165e-001, 6.38544354882282e-002, 1.78078380872354e-001, 9.14640715648355e-001, 3.93781976020287e-001, -1.74395851740135e+000, -7.17854636247488e-001, 1.00944283130971e+000, 2.96008788137909e-001, 1.35432540074552e+000, -1.72763945487988e-001, 2.48890016283936e-001 };

double hidden_output_wts[1][33]=
{
 {-3.49103964612323e-001, -5.24505523747147e-001, 1.15571322066768e+000, 4.83507722864500e-001, 1.77805376469197e-001, 2.91227085963318e+000, 1.65727053132712e-001, 7.21085387129276e-001, -3.36683125766508e-001, 7.43635545078583e-001, -6.90559390025895e-001, -1.18162753201962e+000, -2.75341741512784e-001, -1.03381892822923e+000, -4.01711189478087e-001, 5.85736783721966e-001, 6.43949369456837e-001, 1.13796732384009e+000, 8.67665723283903e-001, 5.75430840467025e-001, 3.48333854394492e-001, -6.34033687147389e-001, -5.28664995635213e-001, -4.53861826074717e-001, -1.29217829519030e+000, 7.68823179203483e-001, 2.82778843216538e-001, 1.54671426645514e-001, -1.10601748937734e+000, -5.54240351238062e-001, -1.58089530728647e+000, 5.43282030007873e-001, -4.23679194029703e-001 }
};

double output_bias[1]={ -2.16088991422112e-001 };

double max_input[6]={ 6.43300000000000e-002, 5.64700000000000e-002, 7.94000000000000e-002, 1.69420000000000e-001, 3.30470000000000e+001, 3.14820000000000e-001 };

double min_input[6]={ 1.90000000000000e-003, 4.68000000000000e-003, 5.70000000000000e-003, 1.40300000000000e-002, 8.44100000000000e+000, 6.50000000000000e-004 };

double max_target[1]={ 1.00000000000000e+000 };

double min_target[1]={ 0.00000000000000e+000 };

double input[6];
double hidden[33];
double output[1];

void ScaleInputs(double* input, double minimum, double maximum, int size)
{
 double delta;
 long i;
 for(i=0; i<size; i++)
 {
	delta = (maximum-minimum)/(max_input[i]-min_input[i]);
	input[i] = minimum - delta*min_input[i]+ delta*input[i];
 }
}

void UnscaleTargets(double* output, double minimum, double maximum, int size)
{
  double delta;
  long i;
  for(i=0; i<size; i++)
  {
    delta = (maximum-minimum)/(max_target[i]-min_target[i]);
    output[i] = (output[i] - minimum + delta*min_target[i])/delta;
   }
}

double logistic(double x)
{
  if(x > 100.0) x = 1.0;
  else if (x < -100.0) x = 0.0;
  else x = 1.0/(1.0+exp(-x));
  return x;
}

void ComputeFeedForwardSignals(double* MAT_INOUT,double* V_IN,double* V_OUT, double* V_BIAS,int size1,int size2,int layer)
{
  int row,col;
  for(row=0;row < size2; row++) 
    {
      V_OUT[row]=0.0;
      for(col=0;col<size1;col++)V_OUT[row]+=(*(MAT_INOUT+(row*size1)+col)*V_IN[col]);
      V_OUT[row]+=V_BIAS[row];
      if(layer==0) V_OUT[row] = exp(V_OUT[row]);
      if(layer==1) V_OUT[row] = logistic(V_OUT[row]);
   }
}

void RunNeuralNet_Regression () 
{
  ComputeFeedForwardSignals((double*)input_hidden_weights,input,hidden,hidden_bias,6, 33,0);
  ComputeFeedForwardSignals((double*)hidden_output_wts,hidden,output,output_bias,33, 1,1);
}

int main(int argc, char *argv[])
{
    if(argc == 7){
        input[0] = atof(argv[1]);
    	input[1] = atof(argv[2]);
    	input[2] = atof(argv[3]);
    	input[3] = atof(argv[4]);
    	input[4] = atof(argv[5]);
    	input[5] = atof(argv[6]);
        ScaleInputs(input,0,1,6);
    	RunNeuralNet_Regression();
    	UnscaleTargets(output,0,1,1);
    	printf("PredictedState=%lf",output[0]);
        return 0;
     }else{
         printf("Not given enough arguments");
         return -1;
    }
}

